---
permalink: Mag-Compiler
time: 2016-05-18 21:05
---
完成一个编译器对于我的意义或许有些与众不同。但是具体的已不需要写。刚刚结束了编译器的presentation。技术细节已经不重要了，剩下的大约就只是情怀。现在假如要我再写一遍编译器，我能比之前写得顺利得多。这就足够了。

我现在仔细回想这一个月，却似乎已有一些模糊。最最清晰的，大概就是弄懂一个问题或是新接触一个概念时的那种欣喜若狂吧。像是走在早春的阳光里，小径旁探出一枝，碎碎的小花，蓬勃的生机。
<!--excerpt-->

譬如SymbolTable，辣酱设计的符号表可以说是既简洁又无比精妙。它的主体只有一个嵌套了stack的map和一个装着map的stack，但它却很轻松地实现了local scope的进入退出与全局的查询。又比如frame的概念。frame是一个函数在栈上对应的一块空间，它按顺序留出物理寄存器、虚拟临时寄存器和函数参数的存储位置。这里就有一个可供优化的点：在为叶函数分配frame时可以不存储所使用的物理寄存器。

编译器上了七八次课，每一次听完总感觉到被巨大的茫然笼罩。第一次写这样一个巨大的工程，除了无从下手，只剩下一片空白。老师课上讲的原理难以建立到代码的映射，而前辈发在github上的代码却像是一个完整的环，不论从何处入手起步，都仿佛无法与前后建立逻辑关系。
花了一个周末时间看ANTLR的文档，却感觉还是没有抓到写.g4应该注意的重点。后来有同学在讨论组里发了github上C语言.g4文件的链接。仿佛像是在深夜大雾茫茫的海上忽然看到了一束远方灯塔的柔光。于是果断放下文档，直接研究规模相对较大的C语言实例。
写到这里忽然发现自己在纠结回忆的语调：流水账？可这期间明明满是情怀。每一个写编译器的周末总是风雨交加，雨下得很爽快，但在我看来却是凄风苦雨。昏黄的路灯，沙哑的鹭鸟，潮湿的空气。迎着夜风，我努力地握着伞柄，伞却在风中歪斜；背上的包像是越来越沉，肩膀有些生疼。包并不重，是往电脑前一坐就轻易溜走的几个小时压得我喘不过气。

但我很庆幸的是，不论曾被虐得多惨，还是能看见代码的优美。计算机对我而言，一直能够保持那种带着些神秘的吸引力。新知，还是最初激动人心的模样。

最后。
感谢LZJ SXY等同学对我的巨大帮助。感谢CLQ同学的解释器以及单元测试。感谢YYR CTY等同学的内嵌函数。感谢XXJ同学的右结合g4。
虽然不确定这几位同学是否会看到。Anyway，非常感谢。


